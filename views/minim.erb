<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <link rel="shortcut icon" href="favicon.ico" />
  <title>VJing Demo</title>
  <link type="text/css" href="style.css" rel="stylesheet" media="screen">
  <script src="bezier.js"></script>
  <script src="MIDIValues.js"></script>
  <script src="mediaLibrary.js"></script>
  <script src="visualFuncs.js"></script>
  <style type="text/css">
  html {cursor: none;}
  #screen > div,
  #screen > div > section {
    position: absolute; top:0px; left:0px;
    width: 100%; height: 94vh;
  }
  .video {display:none;}
  .video video {width:100%; height:auto;}
  .css {background-color: black;}
  #screen-left {opacity: 1;}
  #screen-right {opacity: 0;}
  </style>
</head>

<body>
  <div class="container">
    <section id="controls">
      <button id="play-audio">Play Audio</button>
      <button id="use-mic">Use Mic</button>
      <audio id="simon" src="media/daveClarkeIloveTecho2014.mp3" loop></audio>
    </section>

    <section id="screen">

      <div id="screen-left">
        <section class="video">
          <video id="video-one" autoplay loop>
            <source src="media/cartoons/thundercats01.mp4" type="video/mp4">
          </video>
        </section>
        <section class="css">
          <section class="abstract square-lights" id="squareLights">
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
          </section>

          <section class="abstract sized-squares" id="difSizedCircles">
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
          </section>

          <section class="abstract crazy-circles" id="crazyCircles">
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
          </section>
        </section>
      </div>


      <div id="screen-right">
        <section class="video">
          <video id="video-two" autoplay loop>
            <source src="media/cartoons/heman.mp4" type="video/mp4">
          </video>
        </section>
        <section class="css">
          <section class="abstract square-lights" id="squareLights">
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
            <i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i><i></i>
          </section>

          <section class="abstract sized-squares" id="difSizedCircles">
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
            <b></b><b></b><b></b>
          </section>

          <section class="abstract crazy-circles" id="crazyCircles">
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
            <em></em><em></em><em></em>
          </section>
        </section>
      </div>

      <div id="black"></div>
      <div id="white"></div>
    </section>
  </div>
</body>

<script type="text/javascript">

// ~~~~ SETUP vars
var AudioContext = (window.AudioContext || window.webkitAudioContext);

var simonSoundEl = document.getElementById('simon'),
  playButton = document.getElementById('play-audio'),
  micButton = document.getElementById('use-mic'),
  lightEls = document.getElementsByTagName('i'),
  circleEls = document.getElementsByTagName('b'),
  zCircleEls = document.getElementsByTagName('em'),
  videoElOne = document.getElementById('video-one'),
  videoElTwo = document.getElementById('video-two'),
  // videoCont = document.getElementById('video'),
  // cssCont = document.getElementById('css'),
  blackEl = document.getElementById('black'),
  whiteEl = document.getElementById('white'),
  leftScreen = document.getElementById('screen-left'),
  leftVidEl = leftScreen.getElementsByClassName('video')[0],
  leftCssEl = leftScreen.getElementsByClassName('css')[0],
  rightScreen = document.getElementById('screen-right'),
  rightVidEl = rightScreen.getElementsByClassName('video')[0],
  rightCssEl = rightScreen.getElementsByClassName('css')[0],
  set = 'css',
  threshold = 0,
  elColour = 0,

  // currentCssEl = document.getElementById('squareLights'),
  // nextCssEl,
  squaredLights = document.getElementById('squareLights'),
  sizedCircles = document.getElementById('difSizedCircles'),
  crazyCircles = document.getElementById('crazyCircles'),
  leftSquaredLights = leftScreen.getElementsByClassName('square-lights')[0],
  leftSizedSquares = leftScreen.getElementsByClassName('sized-squares')[0],
  leftCrazyCircles = leftScreen.getElementsByClassName('crazy-circles')[0],
  rightSquaredLights = rightScreen.getElementsByClassName('square-lights')[0],
  rightSizedSquares = rightScreen.getElementsByClassName('sized-squares')[0],
  rightCrazyCircles = rightScreen.getElementsByClassName('crazy-circles')[0],

  audioAPI = new AudioContext,
  guiltMp3 = audioAPI.createMediaElementSource(simonSoundEl),
  analyserNode = audioAPI.createAnalyser(),
  frequencyData = new Uint8Array(1024),
  easing = BezierEasing(0.2, 0.8, 0.8, 0.2);
  
// ~~~~ ANALYSER
analyserNode.fftSize = 2048;

// set up getUserMedia
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

var playGuilt = function playGuilt() {
  guiltMp3.connect(analyserNode);
  guiltMp3.connect(audioAPI.destination);
  analyserNode.connect(audioAPI.destination);
  simonSoundEl.play();
  // flashLights();
  // sizeCircles();
  // crazedCircles();
  mixScreens();
}

var pickUpSound = function pickUpSound(stream) {
  var ambientNoise = audioAPI.createMediaStreamSource(stream);
  ambientNoise.connect(analyserNode);
  mixScreens();
}

//play track
playButton.onclick = function() {
  if (simonSoundEl.paused) {
    playGuilt();
  } else {
    simonSoundEl.pause();
  }
}
//or pick up sound
micButton.onclick = function() {
  navigator.getUserMedia(
  {audio:true},
    pickUpSound,
    function(err) {
      console.log("The following error occured: " + err);
    } 
  );
}

navigator.getUserMedia(
{audio:true},
  pickUpSound,
  function(err) {
    console.log("The following error occured: " + err);
  } 
);

//switch to mic input

//switch to play track

//keep track playing switch to video with MIDI
// ----------------MIDI SHIZZLE
var midi, data;
// request MIDI access
if (navigator.requestMIDIAccess) {
    navigator.requestMIDIAccess({
        sysex: false
    }).then(onMIDISuccess, onMIDIFailure);
} else {
    alert("No MIDI support in your browser.");
}

// midi functions
function onMIDISuccess(midiAccess) {
    // when we get a succesful response, run this code
    midi = midiAccess; // this is our raw MIDI data, inputs, outputs, and sysex status

    var inputs = midi.inputs.values();
    // loop over all available inputs and listen for any MIDI input
    for (var input = inputs.next(); input && !input.done; input = inputs.next()) {
        // each time there is a midi message call the onMIDIMessage function
        input.value.onmidimessage = onMIDIMessage;
    }


}

function onMIDIFailure(error) {
    // when we get a failed response, run this code
    console.log("No access to MIDI devices or your browser doesn't support WebMIDI API. Please use WebMIDIAPIShim " + error);
}

var vidFile = 'heman';
function onMIDIMessage(message) {
    data = message.data;
    // console.log('MIDI data', data);

    // Threshold for mixing - this show/hides screens
    if ( (data[0] === minim.cross[0]) && (data[1] === minim.cross[1]) ) {
      var bezierVal = data[2]/127;
      threshold = ( easing(bezierVal) )*340
      // console.log('midi:'+data[2]+'bezier:'+bezierVal+'threshold:'+threshold);
      console.log(data[2],bezierVal,threshold);
    }
    // if top left button show cartoon one
    if ( (data[0] === minim.left.button1.onPress[0]) && (data[1] === minim.left.button1.onPress[1]) ) {
      showVideo(leftVidEl, leftCssEl);
      set = 'cartoonsOne';
    }
    // if second left button show cartoons two
    if ( (data[0] === minim.left.button2.onPress[0]) && (data[1] === minim.left.button2.onPress[1]) ) {
      showVideo(leftVidEl, leftCssEl);
      set = 'cartoonsTwo';
    }
    // if third left button show abstract
    if ( (data[0] === minim.left.button3.onPress[0]) && (data[1] === minim.left.button3.onPress[1]) ) {
      showVideo(leftVidEl, leftCssEl);
      set = 'abstractLeft';
    }
    // if forth left button show computer games
    if ( (data[0] === minim.left.button4.onPress[0]) && (data[1] === minim.left.button4.onPress[1]) ) {
      showVideo(leftVidEl, leftCssEl);
      set = 'games';

    }
    // if top right buttons show cartoons
    if ( (data[0] === minim.right.button1.onPress[0]) && (data[1] === minim.right.button1.onPress[1]) ) {
      showVideo(rightVidEl, rightCssEl);
      set = 'cartoonsOne';
    }
    // if second right button show cartoons two
    if ( (data[0] === minim.right.button2.onPress[0]) && (data[1] === minim.right.button2.onPress[1]) ) {
      showVideo(rightVidEl, rightCssEl);
      set = 'cartoonsTwo';
    }
    // if third right button show abstract
    if ( (data[0] === minim.right.button3.onPress[0]) && (data[1] === minim.right.button3.onPress[1]) ) {
      showVideo(rightVidEl, rightCssEl);
      set = 'abstractRight';
    }
    // if forth right button show computer games
    if ( (data[0] === minim.right.button4.onPress[0]) && (data[1] === minim.right.button4.onPress[1]) ) {
      showVideo(rightVidEl, rightCssEl);
      set = 'games';
    }

    //cartoons one set
    if (set === 'cartoonsOne') {
      switch (data[0],data[1]) {
        case minim.left.pad1.onPress[0],minim.left.pad1.onPress[1]:
          vidFile = vidSources.cartoons1[0];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.left.pad2.onPress[0],minim.left.pad2.onPress[1]:
          vidFile = vidSources.cartoons1[1];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.left.pad3.onPress[0],minim.left.pad3.onPress[1]:
          vidFile = vidSources.cartoons1[2];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.left.pad4.onPress[0],minim.left.pad4.onPress[1]:
          vidFile = vidSources.cartoons1[3];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        
        case minim.right.pad1.onPress[0],minim.right.pad1.onPress[1]:
          vidFile = vidSources.cartoons1[4];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.right.pad2.onPress[0], minim.right.pad2.onPress[1]:
          vidFile = vidSources.cartoons1[5];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.right.pad3.onPress[0], minim.right.pad3.onPress[1]:
          vidFile = vidSources.cartoons1[6];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.right.pad4.onPress[0], minim.right.pad4.onPress[1]:
          vidFile = vidSources.cartoons1[7];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
      }
    }

    //cartoons two set
    if (set === 'cartoonsTwo') {
      switch (data[0],data[1]) {
        case minim.left.pad1.onPress[0],minim.left.pad1.onPress[1]:
          vidFile = vidSources.cartoons2[0];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.left.pad2.onPress[0],minim.left.pad2.onPress[1]:
          vidFile = vidSources.cartoons2[1];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.left.pad3.onPress[0],minim.left.pad3.onPress[1]:
          vidFile = vidSources.cartoons2[2];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.left.pad4.onPress[0],minim.left.pad4.onPress[1]:
          vidFile = vidSources.cartoons2[3];
          changeVidSrc(videoElOne, 'media/cartoons/'+vidFile+'.mp4');
        break;
        
        case minim.right.pad1.onPress[0],minim.right.pad1.onPress[1]:
          vidFile = vidSources.cartoons2[4];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.right.pad2.onPress[0], minim.right.pad2.onPress[1]:
          vidFile = vidSources.cartoons2[5];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.right.pad3.onPress[0], minim.right.pad3.onPress[1]:
          vidFile = vidSources.cartoons2[6];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
        case minim.right.pad4.onPress[0], minim.right.pad4.onPress[1]:
          vidFile = vidSources.cartoons2[7];
          changeVidSrc(videoElTwo, 'media/cartoons/'+vidFile+'.mp4');
        break;
      }
    }

    // abstract Left
    if (set === 'abstractLeft') {
      switch (data[0],data[1]) {
        case minim.left.pad1.onPress[0],minim.left.pad1.onPress[1]:
          vidFile = vidSources.abstract[0];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.left.pad2.onPress[0],minim.left.pad2.onPress[1]:
          vidFile = vidSources.abstract[1];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.left.pad3.onPress[0],minim.left.pad3.onPress[1]:
          vidFile = vidSources.abstract[2];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.left.pad4.onPress[0],minim.left.pad4.onPress[1]:
          vidFile = vidSources.abstract[3];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        
        case minim.right.pad1.onPress[0],minim.right.pad1.onPress[1]:
          vidFile = vidSources.abstract[4];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.right.pad2.onPress[0], minim.right.pad2.onPress[1]:
          vidFile = vidSources.abstract[5];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.right.pad3.onPress[0], minim.right.pad3.onPress[1]:
          vidFile = vidSources.abstract[6];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.right.pad4.onPress[0], minim.right.pad4.onPress[1]:
          vidFile = vidSources.abstract[7];
          changeVidSrc(videoElOne, 'media/abstract/'+vidFile+'.mp4');
        break;
      }
    }

      // abstract Right
    if (set === 'abstractRight') {
      switch (data[0],data[1]) {
        case minim.left.pad1.onPress[0],minim.left.pad1.onPress[1]:
          vidFile = vidSources.abstract[8];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.left.pad2.onPress[0],minim.left.pad2.onPress[1]:
          vidFile = vidSources.abstract[9];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.left.pad3.onPress[0],minim.left.pad3.onPress[1]:
          vidFile = vidSources.abstract[10];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.left.pad4.onPress[0],minim.left.pad4.onPress[1]:
          vidFile = vidSources.abstract[11];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        
        case minim.right.pad1.onPress[0],minim.right.pad1.onPress[1]:
          vidFile = vidSources.abstract[12];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.right.pad2.onPress[0], minim.right.pad2.onPress[1]:
          vidFile = vidSources.abstract[13];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.right.pad3.onPress[0], minim.right.pad3.onPress[1]:
          vidFile = vidSources.abstract[14];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
        case minim.right.pad4.onPress[0], minim.right.pad4.onPress[1]:
          vidFile = vidSources.abstract[15];
          changeVidSrc(videoElTwo, 'media/abstract/'+vidFile+'.mp4');
        break;
      }
    }

    // games
    if (set === 'games') {
      switch (data[0],data[1]) {
        case minim.left.pad1.onPress[0],minim.left.pad1.onPress[1]:
          vidFile = vidSources.games[0];
          changeVidSrc(videoElOne, 'media/games/'+vidFile+'.mp4');
        break;
        case minim.left.pad2.onPress[0],minim.left.pad2.onPress[1]:
          vidFile = vidSources.games[1];
          changeVidSrc(videoElOne, 'media/games/'+vidFile+'.mp4');
        break;
        case minim.left.pad3.onPress[0],minim.left.pad3.onPress[1]:
          vidFile = vidSources.games[2];
          changeVidSrc(videoElOne, 'media/games/'+vidFile+'.mp4');
        break;
        // case minim.left.pad4.onPress[0],minim.left.pad4.onPress[1]:
        //   vidFile = vidSources.games[3];
        //   changeVidSrc(videoElOne, 'media/games/'+vidFile+'.mp4');
        // break;
        
        case minim.right.pad1.onPress[0], minim.right.pad1.onPress[1]:
          vidFile = vidSources.games[3];
          changeVidSrc(videoElTwo, 'media/games/'+vidFile+'.mp4');
        break;
        case minim.right.pad2.onPress[0], minim.right.pad2.onPress[1]:
          vidFile = vidSources.games[4];
          changeVidSrc(videoElTwo, 'media/games/'+vidFile+'.mp4');
        break;
        case minim.right.pad3.onPress[0], minim.right.pad3.onPress[1]:
          vidFile = vidSources.games[5];
          changeVidSrc(videoElTwo, 'media/games/'+vidFile+'.mp4');
        break;
        // case minim.right.pad4.onPress[0], minim.right.pad4.onPress[1]:
        //   vidFile = vidSources.games[7];
        //   changeVidSrc(videoElTwo, 'media/games/'+vidFile+'.mp4');
        // break;
      }
    }

    // effects

    // black
    if ( (data[0] === minim.topButton1.onPress[0]) && (data[1] === minim.topButton1.onPress[1]) ) {

      if ( data[2] === minim.topButton1.onPress[2] ) {
        blackEl.style.opacity = 1;
      } else if ( data[2] === minim.topButton1.onRelease[2] ) {
        blackEl.style.opacity = 0;
      }
      
    }

    // white
    if ( (data[0] === minim.topButton2.onPress[0]) && (data[1] === minim.topButton2.onPress[1]) ) {

      if ( data[2] === minim.topButton2.onPress[2] ) {
        whiteEl.style.opacity = 1;
      } else if ( data[2] === minim.topButton2.onRelease[2] ) {
        whiteEl.style.opacity = 0;
      }
      
    }

    // invert
    if ( (data[0] === minim.topButton3.onPress[0]) && (data[1] === minim.topButton3.onPress[1]) ) {

      if ( data[2] === minim.topButton3.onPress[2] ) {
        videoElOne.style.webkitFilter = "invert(100%)";
        videoElTwo.style.webkitFilter = "invert(100%)";
      } else if ( data[2] === minim.topButton3.onRelease[2] ) {
        videoElOne.style.webkitFilter = "invert(0%)";
        videoElTwo.style.webkitFilter = "invert(0%)";
      }
      
    }

    // zoom
    if ( (data[0] === minim.topButton4.onPress[0]) && (data[1] === minim.topButton4.onPress[1]) ) {

      if ( data[2] === minim.topButton4.onPress[2] ) {
        rightScreen.style.transform = 'scale(3)';
        leftScreen.style.transform = 'scale(3)';
      } else if ( data[2] === minim.topButton4.onRelease[2] ) {
        rightScreen.style.transform = 'scale(1)';
        leftScreen.style.transform = 'scale(1)';
      }
      
    }

    //

    return data;
}

</script>

</html>
